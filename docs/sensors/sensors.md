# Data

Digital cities often continuously gather and process data. This serves multiple purposes:

1. It allows a digital city to change its state to reflect its real world counterpart.
2. The collected data can be used to create more accurate simulations.
3. The collected data can be analyzed to present statistical information or to discover patterns.

The following sections will explain how data can be collected in our digital twin.

## Sensors

### Registering sensors

Sensors play a pivotal role for data collection in a digital twin. A user or administrator can register
sensors using the sensor page of the UI. Our digital twin differentiates between 'global' sensors and sensors for
specific locations in the city.
Global sensors are interpreted as city wide sensors. For example, a city can contain an official weather station to
track the current weather in the city. At the same time, private individuals or companies have the option to register
sensors specifically for their buildings. These sensors are interpreted as local sensors.
An example of this would be smart meters that track household energy consumption or temperature sensors set up
in different locations of the city for more localized temperature readings.

Sensors can be registered for one or more physical quantities, such as temperature, power, wind speed, ...
Sensors can come in different kinds and formats. To support this diversity, an alias can be provided for each
quantity. It represents the field name that is expected in the messages sent to the sensor-data-ingestor service.
Additionally, a prefix and unit can be selected for each quantity.
The unit represents the unit of measurement, which may differ from the base unit of the quantity.
Prefixes are used to indicate multiples or fractions of the units and can be chosen from a set of standard SI prefixes.

### Sensor-data-ingestor

The service called 'sensor-data-ingestor' is used as a communication point for the sensors.
The sensor-data-ingestor listens for incoming sensor data. The format of the incoming data is
validated. Badly formatted data is rejected. Valid sensor data is temporarily stored for further processing.

### Sensor-data-transformer

The service called 'sensor-data-transformer' transforms the incoming sensor-data into data that can be understood by the
digital twin.
Field names are associated with quantities and measurements are converted to SI units.
After transformation, the data is inserted into the 'sensor_archive' database.

### Sensor-data-generator

To make up for the lack of real-life sensors, the 'sensor-data-generator' was introduced. This service mimics real-life
sensors.
It looks for sensors registered via the UI and creates virtual sensors for them.
These virtual sensors use historic data to generate 'realistic' sensor data in the user-specified format.
This also requires possibly transforming the historic data to different units and prefixes.
Only a few quantities and units are supported by the sensor-data-generator. Different prefixes are always supported.
Valid sensor data can still be generated by the sensor-data-generator for unsupported quantities. However, fields
representing an unsupported quantity will always have a value of 0.0. Just like real-life sensors would do, the
sensor-data-generator periodically sends data to the sensor-data-ingestor service.

Supported quantities and units:

1. Power (watts)
2. Temperature (degrees Celsius, Fahrenheit and Kelvin)
3. Rainfall (millimeters per hour)
4. WindSpeed (meters per second)
5. WindDirection (degrees)
6. Irradiance (watts per square meter)
7. Timestamp (unix timestamp in seconds)

The historic reference point for the virtual measurement is selected by matching the day number (0-366) and the time of
day.
If the sensor-data-generator would only return historic data points,
virtual sensors measuring the same quantity at the same point in time would always return the same value.
To prevent this, virtual sensors do not just return the (transformed) historic value, but randomly adjust the values by
a small proportion (currently 1%) of the value itself. For virtual sensors measuring power,
data for a different household is chosen for every sensor.

#### Historic data

The dataset used by the 'sensor-data-generator' combines weather data with household energy consumption data.
In order to create the dataset, multiple publicly available datasets were aggregated. Special care was taken to
make sure that the different datasets were spatially and temporally aligned. This allows for finding patterns between
weather data and energy consumption data.
Missing values were filled in, unnecessary data removed, timestamps aligned, ...

For weather data, datasets made available by the Centre for Environmental Data Analysis were used.<sup>[1](#ceda)</sup>
For energy consumption data, a dataset was found containing half-hourly energy consumption readings for a sample of
5,567 London Households. This dataset was provided by UK Power Networks.<sup>[2](#energy_dataset)</sup>

The resulting dataset is a clean dataset containing hourly data for household energy consumption, outdoors temperature,
precipitation, wind speed, wind direction and irradiance.
There are multiple entries for each hour, each representing a different household. The dataset is stored via parquet
files, one for every day of the year.
These files can be found in /assets/sensor-data/historic-data.

## References:

<a name="ceda">1</a>: https://data.ceda.ac.uk/badc/ukmo-midas-open/data/uk-hourly-weather-obs

<a name="energy_dataset">2</a>: https://data.london.gov.uk/dataset/smartmeter-energy-use-data-in-london-households
